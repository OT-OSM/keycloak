---
- name: Login to Keycloak Admin API
  ansible.builtin.command: >
    {{ keycloak_install_dir }}/bin/kcadm.sh config credentials
    --server http://localhost:{{ keycloak_http_port }}
    --realm master
    --user {{ keycloak_admin_user }}
    --password {{ keycloak_admin_password }}
  become_user: "{{ keycloak_user }}"
  changed_when: false

- name: Configure OIDC Identity Providers
  ansible.builtin.include_tasks: idp-oidc.yml
  when:
    - keycloak_identity_providers.oidc | bool
    - keycloak_oidc_providers | length > 0

- name: Configure LDAP Identity Providers
  ansible.builtin.include_tasks: idp-ldap.yml
  when:
    - keycloak_identity_providers.ldap | bool
    - keycloak_ldap_providers | length > 0

- name: Configure SAML Identity Providers
  ansible.builtin.include_tasks: idp-saml.yml
  when:
    - keycloak_identity_providers.saml | bool
    - keycloak_saml_providers | length > 0
