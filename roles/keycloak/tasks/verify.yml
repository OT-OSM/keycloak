---
# -------------------------------------------------------------------
# Verify Keycloak service is running
# -------------------------------------------------------------------
- name: Verify Keycloak service is active
  ansible.builtin.command:
    cmd: systemctl is-active keycloak
  register: kc_service_status
  changed_when: false
  failed_when: kc_service_status.stdout != "active"

# -------------------------------------------------------------------
# Informational: HTTPS configuration status
# (No port waiting to avoid runtime TLS dependency)
# -------------------------------------------------------------------
- name: Show HTTPS configuration status
  ansible.builtin.debug:
    msg: >
      Keycloak HTTPS is {{
        'ENABLED' if (keycloak_https_enabled | default(false) | bool)
        else 'DISABLED'
      }}.
      Runtime TLS binding depends on certificate validation.

## High Availability (HA) Deployment

- name: Show HA configuration status
  ansible.builtin.debug:
    msg: >
      Keycloak HA is {{ 'ENABLED' if keycloak_ha_enabled else 'DISABLED' }}.
      Cache stack={{ keycloak_cache_stack }}
